@{
    ViewData["Title"] = "Pedro Costa AI Assistant";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: #f8f9fa;
    font-family: 'Inter', system-ui, sans-serif;
    min-height: 100vh;
}

.container {
    max-width: 900px;
}

.glass-card {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 1rem;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}
.glass-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.4);
}

.btn-tech {
    border-radius: 30px;
    font-weight: 500;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
}
.btn-tech:hover {
    transform: translateY(-2px);
}

input, textarea {
    background-color: rgba(255,255,255,0.05) !important;
    border: 1px solid rgba(255,255,255,0.1) !important;
    color: #f8f9fa !important;
}
input::placeholder, textarea::placeholder {
    color: rgba(255,255,255,0.5);
}

#cvReply, #messageReply, #allMessages {
    background-color: rgba(255,255,255,0.05);
    border-radius: 10px;
    padding: 1rem;
    border-left: 3px solid #0dcaf0;
}
</style>

<div class="container py-5">
    
    <!-- ===== HEADER ===== -->
    <div class="text-center mb-5">
        <img src="~/pics/pedmonte.jpg" class="rounded-circle mb-3 shadow" width="130" height="130" alt="Pedro Costa">
        <h1 class="fw-bold mb-2">Pedro Costa's <span class="text-info">AI Assistant</span> </h1>
        <p class="text-light opacity-75">Get insights about my work, experience, or leave me a message.</p>
    </div>

    <!-- ===== ASK ABOUT CV ===== -->
    <div class="glass-card p-4 mb-5">
        <h3 class="text-info mb-3"><i class="bi bi-terminal"></i>Ask me</h3>
        <div class="input-group mb-3">
            <input type="text" id="cvQuestion" class="form-control" placeholder="Ask about experience, tech stack, projects..." />
            <button class="btn btn-info text-white btn-tech" onclick="askAboutCv()"> Ask me</button>
        </div>
        <div id="cvReply" class="mt-2">Awaiting your question...</div>
    </div>

    <!-- ===== SEND MESSAGE ===== -->
    <div class="glass-card p-4 mb-5">
        <h3 class="text-success mb-3"><i class="bi bi-send"></i> Contact Me</h3>
        <div class="row">
            <div class="col-md-6 mb-3">
                <input type="text" id="companyName" class="form-control" placeholder="Company name" />
            </div>
            <div class="col-md-6 mb-3">
                <input type="text" id="contactName" class="form-control" placeholder="Your contact" />
            </div>
        </div>
        <textarea id="contactMessage" class="form-control mb-3" rows="4" placeholder="Type your message..."></textarea>
        <button class="btn btn-success btn-tech" onclick="sendUserMessage()">Send Message</button>
        <div id="messageReply" class="mt-3">Waiting to send message...</div>
    </div>

    <!-- ===== ADMIN MESSAGES ===== -->
    <div class="glass-card p-4">
        <h3 class="text-warning mb-3"><i class="bi bi-lock"></i> Admin Panel</h3>
        <div class="input-group mb-3" style="max-width:400px;">
            <input type="password" id="adminPassword" class="form-control" placeholder="Enter admin password" />
            <button class="btn btn-warning text-dark btn-tech" onclick="fetchAllMessages()">Enter</button>
        </div>
        <div id="allMessages"></div>
    </div>
</div>

<!-- Icons + Bootstrap JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// === Logic unchanged, but replies slightly styled ===

async function askAboutCv() {
    const replyDiv = document.getElementById("cvReply");
    const question = document.getElementById("cvQuestion").value.trim();
    if (!question) { replyDiv.innerText = "Please type your question."; return; }

    replyDiv.innerHTML = `<div class="spinner-border text-info" role="status"></div> Thinking...`;

    try {
        const res = await fetch("/Chat/Ask", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "userMessage=" + encodeURIComponent(question)
        });
        const data = await res.json();
        replyDiv.innerHTML = `<p class="mb-0">${data.reply}</p>`;
        document.getElementById("cvQuestion").value = "";
    } catch (err) {
        replyDiv.innerHTML = `<span class="text-danger">Error: ${err}</span>`;
    }
}

async function sendUserMessage() {
    const company = document.getElementById("companyName").value.trim();
    const contact = document.getElementById("contactName").value.trim();
    const message = document.getElementById("contactMessage").value.trim();
    const replyDiv = document.getElementById("messageReply");

    if (!company || !contact || !message) {
        replyDiv.innerText = "Please fill in all fields.";
        return;
    }

    replyDiv.innerHTML = `<div class="spinner-border text-success"></div> Sending...`;

    const userMessage = `Send a message to Company: ${company}, Contact: ${contact}, Message: ${message}`;
    try {
        const res = await fetch("/Chat/SendMessage", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "userMessage=" + encodeURIComponent(userMessage)
        });
        const data = await res.json();
        replyDiv.innerHTML = `<span class="text-success">${data.reply}</span>`;
        document.getElementById("companyName").value = "";
        document.getElementById("contactName").value = "";
        document.getElementById("contactMessage").value = "";
    } catch (err) {
        replyDiv.innerHTML = `<span class="text-danger">Error: ${err}</span>`;
    }
}

async function fetchAllMessages() {
    const replyDiv = document.getElementById("allMessages");
    const password = document.getElementById("adminPassword").value.trim();
    if (!password) { replyDiv.innerText = "Please enter the password."; return; }

    replyDiv.innerHTML = `<div class="spinner-border text-warning"></div> Loading...`;

    try {
        const formData = new URLSearchParams();
        formData.append("password", password);
        const res = await fetch("/Chat/GetAllMessages", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: formData.toString()
        });
        const data = await res.json();

        if (!data.success) {
            replyDiv.innerHTML = `<span class="text-danger">${data.reply}</span>`;
            return;
        }

        if (!data.messages.length) {
            replyDiv.innerHTML = `<p>No messages yet.</p>`;
            return;
        }

        replyDiv.innerHTML = data.messages.map(m => `
            <div class="p-3 mb-2 rounded border border-light bg-dark bg-opacity-25">
                <h6 class="text-info mb-1">${m.company} / <span class="text-light">${m.contact}</span></h6>
                <p class="mb-1">${m.message}</p>
                <small class="text-secondary">${m.date}</small>
            </div>
        `).join("");

    } catch (err) {
        replyDiv.innerHTML = `<span class="text-danger">Error: ${err}</span>`;
    }
}
</script>


